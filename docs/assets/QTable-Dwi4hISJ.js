import{b as n,p,d as f,e as h}from"./__uno-DeMoJ9bO.js";import{CTable as b}from"./CTable-ChbrZXMN.js";import{v as y,u as w,w as m,x as C,y as g,z as $,h as S,s as A,n as D}from"./game-DL8LDPfG.js";import{v as _}from"./view-CYZcWMPk.js";var v=Object.defineProperty,j=Object.getOwnPropertyDescriptor,q=Object.getPrototypeOf,x=Reflect.get,I=(e,t,s)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Q=(e,t,s,a)=>{for(var r=a>1?void 0:a?j(t,s):t,l=e.length-1,o;l>=0;l--)(o=e[l])&&(r=(a?o(t,s,r):o(r))||r);return a&&r&&v(t,s,r),r},N=(e,t,s)=>(I(e,t+"",s),s),V=(e,t,s)=>x(q(e),s,t);let i=class extends b{canUnlock(e){const t=n.techs;return!t.has(e.name)&&e.prereqs.every(s=>this.items.some(a=>a.name==s&&t.has(a.name)))}async updateContents(e,t){this.items=p(y,e,t)}unlock(e){P({name:"研究"+e.name,desc:"",slot:_.selectedSlot,remainTime:e.time,recipeId:-1,value:-1}),this.updateValue("item")}unlocked(e){return n.techs.has(e.name)}};N(i,"observedAttributes",V(i,i,"observedAttributes"));i=Q([f("tech-tree")],i);const[d]=document.getElementsByTagName("tech-tree");function T(){d.updateContents(d.page,d.filter)}const X=Object.freeze(Object.defineProperty({__proto__:null,get TechTree(){return i},updateTechs:T},Symbol.toStringTag,{value:"Module"}));var O=Object.defineProperty,B=Object.getOwnPropertyDescriptor,E=Object.getPrototypeOf,G=Reflect.get,M=(e,t,s)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,z=(e,t,s,a)=>{for(var r=a>1?void 0:a?B(t,s):t,l=e.length-1,o;l>=0;l--)(o=e[l])&&(r=(a?o(t,s,r):o(r))||r);return a&&r&&O(t,s,r),r},R=(e,t,s)=>(M(e,t+"",s),s),F=(e,t,s)=>G(E(e),s,t);const[U]=document.getElementsByTagName("game-menu");function L(e){const t=e.slot;if(e.value<0)n.techs.add(e.name.substring(2)),T();else{g(t,e.value);const a=e.value&255,[r]=S(a);r&&A(t,r.id,r.period),t==_.selectedSlot&&U.updateValue("selectedSlot")}n.tasks.splice(n.tasks.findIndex(a=>a.name==e.name&&a.slot==t),1);const s=n.stats;switch(e.name.substring(0,2)){case"建造":s.totalBuild++;break;case"升级":s.totalUpgrade++;break;case"降级":case"拆除":s.totalDestroy++;break}}let c=class extends b{maxTasks=10;get selectAll(){return this.items.length>0&&this.items.every(e=>e.selected)}set selectAll(e){this.items.forEach(t=>t.selected=e)}get selectedCount(){return this.items.filter(e=>e.selected).length}connectedCallback(){super.connectedCallback(),w.add(()=>this.updateQueue())}render(e,t){switch(typeof t){case"number":return e=="time"?new Date(t).toLocaleString():t+""}return t??""}updateQueue(){for(let e=0;e<this.items.length;){const t=this.items[e++];t.paused||(this.update(t)?(!n.mode||--t.remainTime<=0)&&(this.items.splice(--e,1),u.page.updateValue("data"),L(t)):t.paused=!0)}}update(e){let t=e.recipeId>=0?m(e.slot,e.recipeId,e.k||1):0;if(t==3&&(t=m(-1,e.recipeId,e.k||1)),t){let s=`${e.name}已暂停：`;return(t&255)>4&&(s+=D[t>>8]),h(s+C[t&255]),!1}if(e.value>=0){const s=Math.round(7*e.remainTime/e.time);g(e.slot,e.value|s<<12)}return!0}switch(){for(const e of this.items)e.selected&&(e.paused=!e.paused)}cancel(){const e=n.tasks,t=this.items;for(let s=t.length;--s>=0;){const a=t[s];if(a.selected){const r=e.findIndex(l=>l.name==a.name&&l.slot==a.slot);r>=0&&(e.splice(r,1),u.page.updateValue("data"))}}}async updateContents(e,t){this.items=p(n.tasks,e,t)}toCoord=$};R(c,"observedAttributes",F(c,c,"observedAttributes"));c=z([f("q-table")],c);const[u]=document.getElementsByTagName("q-table");function P(e){n.tasks.length>=u.maxTasks?h("任务队列已满"):(e.time=e.remainTime,n.tasks.push(e),u.page.updateValue("data"))}const Y=Object.freeze(Object.defineProperty({__proto__:null,get QTable(){return c},queue:P},Symbol.toStringTag,{value:"Module"}));export{Y as Q,X as T,P as q};
