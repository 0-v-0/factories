import{e as b,C as m,l as p,a as w,w as f,b as Y,s as d}from"./__uno-B1MfMtFg.js";import{v as o}from"./view-Cj0vNHUu.js";import{l as y,u}from"./game-Dc4kIq-d.js";const h=n=>[...n.querySelectorAll("[role=tablist] [role=tab]")].filter(t=>t.closest(n.tagName)==n);function E(n){return n?[["ArrowDown","ArrowRight"],["ArrowUp","ArrowLeft"]]:[["ArrowRight"],["ArrowLeft"]]}class X extends HTMLElement{get storageKey(){return this.getAttribute("storage-key")}set storageKey(t){t?this.setAttribute("storage-key",t):this.removeAttribute("storage-key")}constructor(){super(),this.addEventListener("keydown",t=>{const e=t.target;if(!(e instanceof HTMLElement)||e.closest(this.tagName)!=this||e.getAttribute("role")!="tab"&&!e.closest("[role=tablist]"))return;const s=h(this),i=s.indexOf(s.find(a=>a.ariaSelected=="true")),[c,l]=E(e.closest("[role=tablist]")?.ariaOrientation=="vertical");let r;c.some(a=>t.code==a)?(r=i+1,r>=s.length&&(r=0),this.select(r)):l.some(a=>t.code==a)?(r=i-1,r<0&&(r=s.length-1),this.select(r)):t.code=="Home"?(this.select(0),t.preventDefault()):t.code=="End"&&(this.select(s.length-1),t.preventDefault())}),this.addEventListener("click",t=>{const e=h(this);if(t.target instanceof Element&&t.target.closest(this.tagName)==this){const s=t.target.closest("[role=tab]");if(!(s instanceof HTMLElement)||!s.closest("[role=tablist]"))return;this.select(e.indexOf(s))}})}connectedCallback(){for(const t of h(this))t.ariaSelected||(t.ariaSelected="false"),t.tabIndex==-1&&(t.tabIndex=t.ariaSelected=="true"?0:-1);if(this.storageKey){const t=sessionStorage.getItem(this.storageKey);t!=null&&this.select(+t)}}select(t){const e=h(this),s=[...this.querySelectorAll("[role=tabpanel]")].filter(a=>a.closest(this.tagName)==this),i=e[t],c=s[t];if(!this.dispatchEvent(new CustomEvent("tab-container-change",{bubbles:!0,cancelable:!0,detail:{relatedTarget:c}})))return;for(const a of e)a!=i&&(a.ariaSelected="false",a.tabIndex=-1);for(const a of s)a.hidden=!0,a.tabIndex==-1&&!a.hasAttribute("data-no-tabstop")&&(a.tabIndex=0);i.ariaSelected="true",i.tabIndex=0,i.focus(),c.hidden=!1,this.dispatchEvent(new CustomEvent("tab-container-changed",{bubbles:!0,detail:{relatedTarget:c}}));const r=this.storageKey;r&&sessionStorage.setItem(r,t+"")}}customElements.define("tab-container",X);let g=0;class v extends m{showDetails=!1;showLevel;showEff;showExtra;showProgress;distance=0;offsetX=0;offsetY=0;camLock=!1;speed=1;autosave=10;get selectedSlot(){return o.selectedSlot}async connectedCallback(){await p(sessionStorage.getItem("world")),await y(o.setTexture.bind(o)),this.resetCam(),await w(this),this.showLevel=(f.opts&1)!=0,this.showEff=(f.opts&2)!=0,this.showExtra=(f.opts&4)!=0,this.showProgress=(f.opts&8)!=0,super.connectedCallback(),Y(this,function(){const{showLevel:t=!1,showEff:e=!1,showExtra:s=!0,showProgress:i=!0}=this;o.setOptions((t?1:0)|(e?2:0)|(s?4:0)|(i?8:0))}),addEventListener("beforeunload",()=>d()),u.add(t=>{f.stats.playTime++,this.autosave&&t%this.autosave==0&&d()}),this.update()}onClick(t){o.select(t.offsetX,t.offsetY),this.updateValue("selectedSlot")}onMouseMove(t){t.preventDefault(),this.distance&&(o.offset=[this.offsetX-t.offsetX,this.offsetY-t.offsetY])}onMouseDown(t){t.button==0&&!this.camLock&&(this.distance=1,this.offsetX+=t.offsetX,this.offsetY+=t.offsetY)}onMouseUp(t){t.button==0&&(this.distance=0,!this.camLock&&t.type=="mouseup"&&(this.offsetX-=t.offsetX,this.offsetY-=t.offsetY))}onWheel(t){if(!this.camLock){const e=Math.sign(t.deltaY),s=o.scale;(e>0&&s>1/200||e<0&&s<.1)&&(o.scale=1/(1/s+e)),o.offset=[o.offset[0]-t.offsetX*e*.03,o.offset[1]-t.offsetY*e*.03]}}onTouchStart(t){if(!this.camLock){const[e,s]=t.touches;if(t.touches.length==2){this.offsetX+=e.clientX+s.clientX>>1,this.offsetY+=e.clientY+s.clientY>>1;const i=e.pageX-s.pageX,c=e.pageY-s.pageY;this.distance=Math.sqrt(i*i+c*c)}else this.distance=1,this.offsetX+=e.clientX,this.offsetY+=e.clientY}}onTouchEnd(t){this.distance=0,this.camLock||(this.offsetX-=t.changedTouches[0].clientX,this.offsetY-=t.changedTouches[0].clientY)}onTouchMove(t){t.preventDefault();const e=t.touches;if(this.distance){const[s]=e;if(o.offset=[this.offsetX-s.clientX,this.offsetY-s.clientY],e.length==2){const i=s.pageX-e[1].pageX,c=s.pageY-e[1].pageY,l=Math.sqrt(i*i+c*c);o.scale=o.slotSize*l/o.canvas.width/this.distance}}}back(){d(),location.href="./index.html"}resetCam(){this.offsetX=this.offsetY=0,o.offset=[0,0],o.scale=o.slotSize/o.canvas.width}update(){if(setTimeout(()=>this.update(),this.speed?1e3/Math.min(this.speed,5):1e3),!!this.speed){g++;for(const t of u)t(g)}}}customElements.define("game-menu",v);document.body.style.overflowY="hidden";addEventListener("error",n=>b(n.message+" "+n.error?.stack));addEventListener("unhandledrejection",n=>b(n.reason));
